<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Validation Test</title>
<style>
body {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	background-color: #ffc;
}
body.pass {
	background: #cfc;
}
body.fail {
	background: #fcc;
}
h1 {
	font-size: 128pt;
	margin: 0;
}
button {
	padding: 0.5rem;
	font-size: 16pt;
	cursor: pointer;
}
</style>
</head>
<body>
<h1>ü§îÔ∏è</h1>
<script type="module">
import {ens_normalize} from '../dist/all.min.js';
const h1 = document.querySelector('h1');
fetch('../validate/tests.json').then(r => r.json()).then(tests => {	
	// see: validate.js
	let errors = [];
	for (let test of tests) {
		let {name, norm, error} = test;
		if (typeof norm !== 'string') norm = name;
		try {
			let result = ens_normalize(name);
			if (error) {	
				errors.push({type: 'expected error', result, ...test});
			} else if (result !== norm) {
				errors.push({type: 'wrong norm', result, ...test});
			}
		} catch (err) {
			if (!error) {
				errors.push({type: 'unexpected error', result: err.message, ...test});
			}
		}
	}
	if (errors.length) {
		show_error(`${errors.length} tests failed`);
		let a = document.createElement('a');
		a.download = 'errors.json';
		a.innerHTML = `<button>${a.download}</button>`;
		a.href = URL.createObjectURL(new Blob([JSON.stringify(errors, null, '\t')], {
			type: 'application/json',
		}));
		document.body.append(a);
	} else {
		document.body.classList.add('pass');
		h1.innerText = '‚úÖ';
	}
}).catch(err => {
	show_error(err.message);
});
function show_error(s) {
	document.body.classList.add('fail');
	h1.innerHTML = `‚ùåÔ∏è`;
	let reason = document.createElement('h2');
	reason.innerText = s;
	document.body.append(reason);
}
</script>
</body>
</html>